C251 COMPILER V5.60.0,  bootloader                                                         20/10/24  10:38:11  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE bootloader
OBJECT MODULE PLACED IN .\Objects\bootloader.obj
COMPILER INVOKED BY: D:\Compiler\Keil_v5\C251\BIN\C251.EXE Bootloader\src\bootloader.c XSMALL FUNCTIONS(REENTRANT) FLOAT
                    -64 OPTIMIZE(3,SPEED) INCDIR(.\Bootloader\inc) DEBUG PRINT(.\Objects\bootloader.lst) TABS(2) OBJECT(.\Objects\bootloader.
                    -obj) 

stmt  level    source

    1          /*
    2           * bootloader.c
    3           *
    4           *  Created on: Mar. 25, 2020
    5           *      Author: Alka
    6           *  Porting on: Mar. 13, 2024
    7           *    Porting code from F051 to STC8051U
    8           *  
    9           *
   10           */
   11          
   12          #include "bootloader.h"
   13          #include <string.h>
   14          
   15          
   16          #define page_size 0x200                   // 512 bytes for STC8051U
   17          
   18          
   19          void save_flash_nolib(uint8_t *dat, int length, uint32_t add){
   20   1      
   21   1        IAP_ENABLE();                         
   22   1        // unlock flash
   23   1        // erase page if address even divisable by 512
   24   1        if((add % page_size) == 0){
   25   2      
   26   2          IAP_ERASE();                        
   27   2      
   28   2          IAP_ADDRE = (uint8_t)(add >> 16); 
   29   2          IAP_ADDRH = (uint8_t)(add >> 8);  
   30   2          IAP_ADDRL = (uint8_t)add;         
   31   2      
   32   2          IAP_TRIG = 0x5A;
   33   2          IAP_TRIG = 0xA5;                   
   34   2          _nop_();   
   35   2          _nop_();
   36   2          _nop_();
   37   2          _nop_();
   38   2      
   39   2          while(CMD_FAIL);                  
   40   2        }
   41   1      
   42   1        IAP_WRITE();                        //å®è°ƒç”¨, é€å­—èŠ‚å†™å‘½ä»¤
   43   1        do
   44   1          {
   45   2              IAP_ADDRE = (uint8_t)(add >> 16); 
   46   2              IAP_ADDRH = (uint8_t)(add >> 8);  
   47   2              IAP_ADDRL = (uint8_t)add;         
   48   2              IAP_DATA  = *dat;      
   49   2      
   50   2          IAP_TRIG = 0x5A;
   51   2          IAP_TRIG = 0xA5;                   
   52   2          _nop_();   
   53   2          _nop_();
   54   2          _nop_();
   55   2          _nop_();
   56   2      
   57   2          while(CMD_FAIL);
C251 COMPILER V5.60.0,  bootloader                                                         20/10/24  10:38:11  PAGE 2   

   58   2      
   59   2              add++;                     //ä¸‹ä¸€ä¸ªåœ°å€
   60   2              dat++;                    //ä¸‹ä¸€ä¸ªæ•°æ®
   61   2          }
   62   1          while(--length);                    //ç›´åˆ°ç»“æŸ
   63   1      
   64   1      
   65   1        IAP_DISABLE();                      //å…³é—­IAP
   66   1      }
   67          
   68          void read_flash_bin(uint8_t*  dat , uint32_t add , int out_buff_len){
   69   1        int i;
   70   1        IAP_ENABLE();                           //è®¾ç½®ç­‰å¾…æ—¶é—´ï¼Œå…è®¸IAPæ“ä½œï¼Œé€ä¸€æ¬¡å°±å¤Ÿ
   71   1          IAP_READ();                             //é€å­—èŠ‚è¯»å‘½ä»¤ï¼Œå‘½ä»¤ä¸éœ€æ”¹å˜æ—¶ï¼Œä¸éœ€é‡æ–°é€
             -å‘½ä»¤
   72   1        for (i = 0; i < out_buff_len ; i ++){
   73   2              IAP_ADDRE = (uint8_t)((add+i) >> 16); //é€åœ°å€é«˜å­—èŠ‚ï¼ˆåœ°å€éœ€è¦æ”¹å˜æ—¶æ‰éœ€é‡æ–°é€
             -åœ°å€ï¼‰
   74   2              IAP_ADDRH = (uint8_t)((add+i) >> 8);  //é€åœ°å€ä¸­å­—èŠ‚ï¼ˆåœ°å€éœ€è¦æ”¹å˜æ—¶æ‰éœ€é‡æ–°é€
             -åœ°å€ï¼‰
   75   2              IAP_ADDRL = (uint8_t)(add+i);         //é€åœ°å€ä½å­—èŠ‚ï¼ˆåœ°å€éœ€è¦æ”¹å˜æ—¶æ‰éœ€é‡æ–°é€
             -åœ°å€ï¼‰
   76   2      
   77   2          IAP_TRIG = 0x5A;
   78   2          IAP_TRIG = 0xA5;                   
   79   2          _nop_();   
   80   2          _nop_();
   81   2          _nop_();
   82   2          _nop_();
   83   2          while(CMD_FAIL);
   84   2      
   85   2              dat[i] = IAP_DATA;            //è¯»å‡ºçš„æ•°æ®é€å¾€
   86   2        }
   87   1      
   88   1        IAP_DISABLE();                      
   89   1      }
   90          
   91          


Module Information          Static   Overlayable
------------------------------------------------
  code size            =       275     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =    ------     ------
  xdata-const size     =    ------     ------
  edata size           =    ------     ------
  bit size             =    ------     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =    ------     ------
End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
